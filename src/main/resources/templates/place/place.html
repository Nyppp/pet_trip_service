<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장소 상세 정보</title>
    <link rel="stylesheet" href="/css/place.css">
    <link rel="stylesheet" href="/css/common/common.css">
</head>
<body>
<div th:replace="~{common/header :: siteHeader}"></div>
<main class="container">

    <!-- 상단 영역 -->
    <section class="top-section">
        <div class="image-area">
            <div class="slider" id="place-slider">
                <button class="nav prev" aria-label="이전 사진">‹</button>

                <div class="slides">
                    <img th:each="img,iter : ${place.imageUrls}"
                         th:src="${img}"
                         alt="장소 이미지"
                         onerror="this.src='https://via.placeholder.com/500x350'"
                         th:classappend="${iter.index} == 0 ? 'active' : ''">
                </div>

                <button class="nav next" aria-label="다음 사진">›</button>
            </div>

            <div class="dots" id="place-slider-dots"
                 th:if="${place.imageUrls != null and place.imageUrls.size() > 1}">
                <button th:each="img,iter : ${place.imageUrls}"
                        th:attr="data-index=${iter.index}"
                        th:classappend="${iter.index} == 0 ? 'active' : ''"
                        aria-label="해당 사진으로 이동"></button>
            </div>
        </div>

        <div class="info-area">
            <div class="place-title-row">
                <h1 class="place-title" th:text="${place.name}">장소 이름</h1>

                <div class="like-box">
                    <button
                            id="like-btn"
                            class="like-icon"
                            type="button"
                            th:classappend="${likedByMe} ? ' liked' : ''"
                            th:data-place-id="${place.id}"
                            th:attr="aria-pressed=${likedByMe}"
                            aria-label="찜하기 토글">
                        <img id="like-img"
                             width="24" height="24" alt=""
                             th:src="@{/images/{f}(f=${likedByMe} ? 'heart_filled.svg' : 'heart_outline.svg')}" />
                    </button>
                    <div id="like-count" class="like-count" th:text="${place.liked}">0</div>
                </div>
            </div>
            <p class="category" th:text="${place.categoryPath}">숙소 > 호텔 > 관광호텔</p>
            <div class="rating" th:if="${place != null}">
                <div class="stars"
                     th:style="|--percent: ${ (place.rating != null ? place.rating : 0) * 20 }%|"
                     aria-label="별점"></div>

                <span class="rating-number"
                      th:text="${place.rating != null ? #numbers.formatDecimal(place.rating,1,1) : '0.0'}">0.0</span>
                <span class="review-count"
                      th:if="${place.liked != null and place.liked > 0}"
                      th:text="'(' + ${place.liked} + ')'">(0)</span>
            </div>

            <!-- 라벨/값 줄만 meta-row -->
            <p class="meta-row">
                <strong>주소</strong>
                <span th:text="${!#strings.isEmpty(place.address) ? place.address : '정보 없음'}">정보 없음</span>
            </p>
            <p class="meta-row">
                <strong>전화번호</strong>
                <a th:if="${!#strings.isEmpty(place.phone)}"
                   th:href="'tel:' + ${place.phone}"
                   th:text="${place.phone}">000-0000-0000</a>
                <span th:if="${#strings.isEmpty(place.phone)}">정보 없음</span>
            </p>
            <p class="meta-row">
                <strong>사이트</strong>

                <a th:if="${place.homepageUrl != null and !#strings.isEmpty(place.homepageUrl)}"
                   th:href="${place.homepageUrl}" target="_blank" rel="noopener noreferrer">공식 홈페이지</a>

                <span th:if="${place.homepageUrl == null or #strings.isEmpty(place.homepageUrl)}">
    정보 없음
  </span>
            </p>

            <!-- 설명 + 더보기 버튼을 한 래퍼로 -->
            <div class="desc-wrap" th:if="${!#strings.isEmpty(place.description)}">
                <p id="place-description" class="description" th:text="${place.description}">상세정보</p>
                <button id="toggle-description-btn" class="more-btn" type="button"
                        aria-expanded="false" aria-controls="place-description">더보기
                </button>
            </div>
            <div class="cta-row">
                <button
                        type="button"
                        th:onclick="${userId != null} ?
                            |location.href='@{/users/{userId}/schedules(placeId=${place.id}, userId=${userId})}'| :
                            |location.href='@{/login}'|"
                        class="add-schedule-btn"
                        id="add-schedule-btn">
                    스케줄에 추가
                </button>
            </div>
        </div>
    </section>

    <section class="ai-split" th:attr="data-pid=${place.id}">
        <div class="ai-card ai-card--one">
            <div class="ai-card-header">
                <h2>ALAN AI 요약</h2>
                <button id="ai-update-btn" type="button" class="add-schedule-btn ai-card-btn">
                    업데이트
                </button>
            </div>

            <div class="ai-2col">
                <div class="ai-col">
                    <h3>리뷰</h3>
                    <div id="ai-review" class="ai-raw"
                         th:text="${#strings.isEmpty(place.aiReview) ? 'AI 요약이 아직 없어요.' : place.aiReview}">
                        AI 요약이 아직 없어요.
                    </div>
                </div>

                <div class="ai-col">
                    <h3>반려동물 정보</h3>
                    <div id="ai-pet" class="ai-raw"
                         th:text="${#strings.isEmpty(place.aiPet) ? 'AI 반려동물 정보가 아직 없어요.' : place.aiPet}">
                        AI 반려동물 정보가 아직 없어요.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="user-reviews">
        <h2>사용자 리뷰</h2>

        <div class="review">
            <div class="review-header">
                <img src="https://via.placeholder.com/40" alt="user profile" class="profile-img">
                <div class="review-info">
                    <span class="username">username</span>
                    <span class="review-rating">⭐⭐⭐⭐⭐</span>
                    <span class="review-date">2일 전</span>
                </div>
            </div>
            <p class="review-content">
                위치도 좋고 서비스도 훌륭했어요. 강아지와 함께 편하게 머물 수 있었습니다.
            </p>
            <div class="review-images">
                <img src="https://via.placeholder.com/100" alt="리뷰 이미지 1">
                <img src="https://via.placeholder.com/100" alt="리뷰 이미지 2">
            </div>
        </div>

        <div class="review">
            <div class="review-header">
                <img src="https://via.placeholder.com/40" alt="user profile" class="profile-img">
                <div class="review-info">
                    <span class="username">username</span>
                    <span class="review-rating">⭐⭐⭐⭐</span>
                    <span class="review-date">5일 전</span>
                </div>
            </div>
            <p class="review-content">
                시설이 깨끗하고 반려견 친화적인 분위기입니다.
            </p>
            <div class="review-images">
                <img src="https://via.placeholder.com/100" alt="리뷰 이미지 1">
            </div>
        </div>
    </section>

</main>
<script src="/scripts/place.js"></script>
</body>
</html>